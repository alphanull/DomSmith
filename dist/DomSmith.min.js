/*!
* DomSmith – Javascript Dom library
* @license MIT
* © 2016–2025 Frank Kudermann @ alphanull
*/
class e{constructor(e,t){let r;t&&(r={_ele:t,nodes:[]}),this._refs=new WeakMap,this._events=new WeakMap,this._dom=this.addNode(e,r),this._parent=t,r&&Array.isArray(this._dom)&&(r.nodes=this._dom),this._parent&&this.mount()}mount(e){e&&(this._parent=e),Array.isArray(this._dom)?this._dom.forEach((e=>{e._ele.parentNode&&e._ele.parentNode===this._parent||this._parent.appendChild(e._ele)})):this._dom._ele.parentNode&&this._dom._ele.parentNode===this._parent||this._parent.appendChild(this._dom._ele)}unmount(){Array.isArray(this._dom)?this._dom.forEach((e=>e._ele.remove())):this._dom&&this._dom._ele&&this._dom._ele.parentNode&&this._dom._ele.remove()}addNode(t,r){let o=t||{};if(Array.isArray(o)){return o.map((e=>{const t=this.addNode(e,r);return r&&Array.isArray(r.nodes)&&r.nodes.push(t),t}))}if("string"==typeof o||o instanceof String)o={_ele:document.createTextNode(o)};else{const e="http://www.w3.org/2000/svg",t=!(r&&r._ele&&"foreignobject"===r._ele.tagName.toLowerCase())&&(o.tag&&"svg"===o.tag.toLowerCase()||r&&r._ele&&r._ele.namespaceURI===e);o._ele=t?document.createElementNS(e,o.tag):document.createElement(o.tag||"div")}void 0!==o.text&&(o._ele=document.createTextNode(o.text));const{nodes:s,tag:n,ref:i,events:d,_ele:a}=o;if(Object.entries(o).forEach((([t,r])=>{if(e.nodeProps.includes(t))return;if(("video"===n||"audio"===n?e.getSupportedDomEvents(n):e.supportedEvents).includes(t))this.addEvent(a,t,r);else if(t.includes("."))!function(e,t,r){const o=t.split("."),s=o.slice(0,-1).reduce(((e,t)=>void 0===e||void 0===e[t]?null:e[t]),e);if("object"!=typeof s||null===s)throw new Error(`[DomSmith] Did not find property with path: ${t}`);s[o.pop()]=r}(a,t,r);else if(t in a)try{a[t]=r}catch(e){null!=r&&a.setAttribute(t,r)}else null!=r&&a.setAttribute(t,r)})),d&&Object.entries(d).forEach((([e,t])=>{this.addEvent(a,e,t)})),r&&(o._parent=r),i){if(e.rootProps.includes(i))throw new Error("[DomSmith] Reserved properties are not allowed as ref");if(this[i])throw new Error("[DomSmith] No Duplicate Refs are allowed");this[i]=a,this._refs.set(a,o)}return s&&("string"==typeof s&&(o.nodes=[s]),o.nodes=o.nodes.reduce(((e,t)=>{if(t){const r=this.addNode(t,o);a.appendChild(r._ele),e.push(r)}return e}),[])),o}replaceNode(e,t){const r=this[e],o=this._refs.get(r);if(!o)throw new Error("[DomSmith] invalid ref used with replaceNode");this.removeNode(o);const s=o._parent.nodes.findIndex((e=>e===o)),n=this.addNode(t,o._parent);n._parent._ele.replaceChild(n._ele,o._ele),n._parent.nodes[s]=n,o.ref&&(this[o.ref]=n._ele,this._refs.set(n._ele,n))}removeNode(e=this._dom){Array.isArray(e)?e.forEach((e=>this.removeNode(e))):(this.removeEvent(e._ele),e.events&&delete e.events,e.ref&&(this._refs.delete(this[e.ref]),delete this[e.ref]),e.nodes&&e.nodes.forEach((e=>this.removeNode(e))))}addEvent(e,t,r){if(!r)return;const o="string"==typeof e?this[e]:e;if(!o)throw new Error(`[DomSmith] removeEvent: ele or ref: ${e} not found`);this._events.has(o)||this._events.set(o,{});const s=this._events.get(o);if(s[t]||(s[t]=[]),Array.isArray(r))r.forEach((e=>{if("function"!=typeof e)throw new Error("[DomSmith] Handler must be a function");o.addEventListener(t,e),s[t].push(e)}));else{if("function"!=typeof r)throw new Error("[DomSmith] Handler must be a function");o.addEventListener(t,r),s[t].push(r)}}removeEvent(e,t,r){const o="string"==typeof e?this[e]:e;if(!o)throw new Error(`[DomSmith] removeEvent: ele or ref: ${e} not found`);if(!this._events.has(o))return;const s=this._events.get(o);if(t){if(!s[t])return;r?(o.removeEventListener(t,r),s[t]=s[t].filter((e=>e!==r))):(s[t].forEach((e=>o.removeEventListener(t,e))),delete s[t]),0===Object.keys(s).length&&this._events.delete(o)}else Object.keys(s).forEach((e=>{s[e].forEach((t=>o.removeEventListener(e,t)))})),this._events.delete(o)}teardown(){this.removeNode(),this.unmount(),this._dom=this._refs=this._parent=this._events=null}static getSupportedDomEvents(e="div"){const t=document.createElement(e),r=[];for(const e in t)e.startsWith("on")&&r.push(e.slice(2));return r.sort()}}e.rootProps=["_dom","_refs","_parent","_events","constructor","prototype","addNode","replaceNode","removeNode","addEvent","removeEvent","teardown"],e.nodeProps=["_ele","ref","tag","nodes","text","events"],e.supportedEvents=e.getSupportedDomEvents();export{e as default};
